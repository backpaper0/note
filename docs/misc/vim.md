# Vim

## 移動系

### ひとつ前のカーソル位置に戻る

言ってみればカーソル位置のアンドゥって感じ。

- `control + o`

リドゥはこう。

- `control + i`

### 指定行へジャンプする

ジャンプしたい行数に続いて `G` を押す。

例えば100行目に行きたい場合は `100G` と押す。

### カーソルは固定したままで画面を一行移動する

- `ctrl + e`
- `ctrl + y`

### ビジュアルモードでカーソルを選択範囲の先頭・末尾に移動する

ビジュアルモードで `o` を押せば先頭・末尾を行ったり来たり。

## フォーマットする

```vim
gg=G
```

`gg` でカーソルを先頭に移動して `G` つまりファイルの末尾まで "indent" プログラムとやらを適用する。

- [:h =](http://vim-jp.org/vimdoc-ja/change.html#=)

## `^M` の入力方法

- `control + v, control + m`

置換などで改行を消したい・改行を追加したい場合などに使う。
`^M` はCRっぽい。
LFは `\\r` 。

## 改行コードの指定

```vim
:set fileformat=unix
```

オペランドは `dos` , `unix` , `mac` を指定できる。

## ウィンドウを分割する

```vim
:sp
```

## 分割されたウィンドウを行ったり来たり

`control + w` 押しまくる。

## パターンにマッチした行に対してなにかする

`:g` コマンドを使う。

```vim
:g/re/p
```

これはgrepの例。
パターン( `re` )にマッチした行を出力( `p` )する。

パターンにマッチしなかった行に対してなにかする場合は `:v` コマンドを使う。

## ウィンドウをでかくする

`control + w` を押してから `+` を押すと縦にでかくなる。
`-` だと小さくなる。

`control + w` を押してから `>` を押すと横にでかくなる。
`<` だと小さくなる。

一気にでかく(小さく)したい場合は `control + w` の前に `100` とか付けると良い。

## リドゥ

間違って `u` してしまった場合に心静めるやつ。

- `control + r`

## カーソルの下にあるファイルを開く

- `g f`

## カーソルがある位置を画面の真ん中に持ってくる

`z` を2回押すだけ。

- `z z`

一番上に持ってくるときは `Enter` じゃ。

- `z Enter`

## VimFiler

|操作|コマンド|
|---|---|
|セーフモードを切り替える|`gs`|
|選択する|`Space`|
|全選択|`*`|
|コピー|`c`|
|移動|`m`|
|削除|`d`|
|リネーム|`r`|
|新しいファイルを作る|`N`|
|VimFilerを終了する|`Q`|
|フルパスをyankする|`yy`|
|Vimのカレントディレクトリを移動させる|`gc`|
|ディレクトリを展開する|`t`|
|ディレクトリを再帰的に展開する|`T`|

### VimFilerを使って複数ファイルを一括でリネーム

VimFilerを開き、リネームしたいファイルを選択する。
`Space`で個別に選択、または`*`で全選択。

`gs`でセーフモードを解除する。

`r`でリネームする。

`t`や`T`でディレクトリを展開してファイルを選択すればサブディレクトリのファイルも一括でリネームできる。

## バッファを閉じる

```vim
:bdelete 1
```

数字はバッファの番号。

数字をつけなかったらカレントバッファが閉じる。

## 単語を入れ替える

次の文章の world と Hello を入れ替えたい。

```none
world, Hello!
```

まず自分がやっていた間違いの例を記載。
これ、

- world を `de` で切り取って
- `w` で Hello の先頭に移動、
- Hello を `de` で切り取って
- `p` で Hello を貼付け……あかん！！

とよくやってしまっていた。。。

ビジュアルモードで `p` するとレジスタの中身が置換されるっぽいとう性質を利用して、

- world を `de` で切り取って
- `w` で Hello の先頭に移動、
- `v` でビジュアルモードにして
- `e` で Hello の末尾に移動、
- `p` で world を貼付けて Hello をレジスタに格納、
- `F,` でカンマに移動して
- `P` で Hello を貼付け

とやれば置換できる。

## VimShell

### 新しいVimShellを開く

```vim
:VimShellCreate
```

もしくは、

```vim
:VimShell -create
```

## 大文字・小文字を相互変換する

チルダでキャレット上の文字の大文字小文字を切り替えられる。

## インクリメント・デクリメント

- `ctrl + a` でインクリメント
- `ctrl + x` でデクリメント

## 補完する

- `ctrl + p` で **前方** から候補を探して補完する
- `ctrl + n` で **後方** から候補を探して補完する

## 検索履歴

`q/` または `q?` 。
検索履歴を閉じるには `:q` 。

## 1文字コピーする

`yl`

## git grepでヒットしたファイルをまとめて開く

```sh
vim $(git grep -l foobar)
```

## 文字数が異なる各行の末尾にカーソルを持ってきていっぺんに追記する

例えば、こんな感じのテキストがあった時、

```java
StringBuilder buf = new StringBuilder()
buf.append("Hello, ")
buf.append("world!")
System.out.println(buf)
```

各行の末尾にセミコロンを書く、といったケース。

まず、先頭行の行頭で `ctrl + v` してから `j` などを使い、各行を矩型選択する。

それから `$` を押すと行末にカーソルを移動させられる。

あとは `A` してセミコロンを書き、ノーマルモードに戻れば残りの行にもセミコロンが追記される。

## 複数のバッファを一括置換する

```vim
:bufdo :%s/before/after/g | update
```

## 編集中のバッファの行数を数える

```
:w !wc -l
```

行選択すれば選択された範囲の行数が数えられる。

```
:'<,'>w !wc -l
```

## ファイル一覧を取得してバッファに読み込む

必要に応じて`:cd /path/to/repo`でカレントディレクトリを移動すること。

```
:r !ls
```

`git ls-files`を使えばリポジトリ内のファイルに限定できる。

```
:r !git ls-files
```

Vimを起動していないなら次の方法でも良いかも。

```
ls|vim -
```

## プロンプトのメッセージを確認する

```
:messages
```

## 文字化けした時に開き直す

Shift_JISなCSVを開いてしまうことが度々ある。

```
:e ++enc=shift_jis
```

## Lua入りVimをビルドする

まずLuaをインストールする。

```sh
brew install lua
```

Vimをビルドしてインストールする。

```sh
git clone git@github.com:vim/vim.git
./configure --enable-luainterp --with-lua-prefix=/usr/local/Cellar/lua/5.3.5_1 \
            --enable-gui=no --without-x --enable-multibyte --enable-cscope \
            --enable-rubyinterp --enable-terminal --with-tlib=ncurses
make
sudo make install
```

## 選択している行にコマンドを実行する

よくやるのは`qq`して操作記録したあと特定行に対して`@q`するってやつ。

まず`qq`で操作を記録する。
それからビジュアルモードで適用したい行を選択する。
次のコマンドで選択行に対して`@q`を実行する。

```vim
:'<,'>normal @q
```

もちろん`@q`の部分は別のコマンドでもOK。
